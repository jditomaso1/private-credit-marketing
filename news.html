<section id="media-hub" style="max-width:1100px;margin:0 auto;padding:40px 20px;font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial;">
  <header style="margin-bottom:16px;">
    <h1 style="margin:0 0 6px 0;font-size:32px;font-weight:700;">Media Hub</h1>
    <p style="margin:0;color:#555;">Top headlines in private credit — updated hourly. Click to read at the source.</p>
  </header>

  <!-- Filters -->
  <nav id="filters" style="display:flex;gap:10px;flex-wrap:wrap;margin:18px 0 22px;">
    <button data-tag="All" class="pill pill--active">All</button>
    <button data-tag="Direct Lending" class="pill">Direct Lending</button>
    <button data-tag="CLO" class="pill">CLO</button>
    <button data-tag="NAV" class="pill">NAV</button>
    <button data-tag="BDC" class="pill">BDC</button>
    <button data-tag="ABS" class="pill">ABS</button>
  </nav>

  <!-- Top 10 -->
  <h3 style="margin:10px 0 12px;font-size:20px;">Top 10 Today</h3>
  <div id="top10" class="grid"></div>

  <!-- All Stories -->
  <h3 style="margin:28px 0 12px;font-size:20px;">All Stories</h3>
  <div id="feed" class="list"></div>
</section>

<style>
  .pill{border:1px solid #d5d8dd;background:#fff;color:#222;border-radius:999px;padding:8px 12px;font-size:13px;cursor:pointer}
  .pill--active{background:#2c7cf1;color:#fff;border-color:#2c7cf1}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
  @media (max-width: 820px){ .grid{grid-template-columns:1fr} }
  .card{background:#fff;border:1px solid #eee;border-radius:10px;padding:14px;display:block;text-decoration:none;color:#111}
  .card:hover{box-shadow:0 6px 20px rgba(0,0,0,.08);transform:translateY(-1px);transition:all .15s}
  .card-title{font-weight:600;margin:0 0 6px 0;line-height:1.3}
  .card-meta{font-size:12px;color:#666;margin:0 0 6px 0}
  .card-tags{font-size:12px;color:#666}
  .list a{display:flex;justify-content:space-between;gap:12px;text-decoration:none;border-bottom:1px solid #eee;padding:10px 0;color:#111}
  .list a:hover{background:#fafbfc}
  .list .right{white-space:nowrap;color:#666;font-size:12px}
</style>

<script>
// Fetch + render
const API = '/api/media-feed'; // your serverless endpoint
let _items = [];

function timeAgo(iso){
  const d = new Date(iso);
  const diffMs = Date.now() - d.getTime();
  const m = Math.round(diffMs/60000);
  if (m < 60) return `${m}m`;
  const h = Math.round(m/60);
  if (h < 24) return `${h}h`;
  return `${Math.round(h/24)}d`;
}

function tagPills(tags=[]){
  if (!tags.length) return '';
  return `<span class="card-tags">${tags.join(' · ')}</span>`;
}

function renderTop10(items){
  const el = document.getElementById('top10');
  el.innerHTML = items.slice(0,10).map(i => `
    <a class="card" href="${i.url}" target="_blank" rel="noopener">
      <div class="card-title">${i.title}</div>
      <div class="card-meta">${(i.source||'').replace(/^www\./,'')} · ${timeAgo(i.published_at||i.pubDate||Date.now())}</div>
      ${tagPills(i.tags)}
    </a>
  `).join('');
}

function renderFeed(items){
  const el = document.getElementById('feed');
  el.innerHTML = items.map(i => `
    <a href="${i.url}" target="_blank" rel="noopener">
      <span>${i.title}</span>
      <span class="right">${(i.source||'').replace(/^www\./,'')} · ${timeAgo(i.published_at||i.pubDate||Date.now())}</span>
    </a>
  `).join('');
}

function applyFilter(tag='All'){
  const filtered = tag==='All' ? _items : _items.filter(i => (i.tags||[]).includes(tag));
  renderTop10(filtered);
  // Show “rest” below (skip the ones in Top10)
  renderFeed(filtered.slice(10, 260));
}

async function loadFeed(){
  try{
    const res = await fetch(API, { cache: 'no-store' });
    const data = await res.json();
    // Accept either {top10, items} or just {items}
    _items = (data.items||[]).sort((a,b)=> new Date(b.published_at||b.pubDate) - new Date(a.published_at||a.pubDate));
    applyFilter('All');
  }catch(e){
    console.error('Feed load error', e);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // Filters
  document.querySelectorAll('#filters .pill').forEach(btn=>{
    btn.addEventListener('click', () => {
      document.querySelectorAll('#filters .pill').forEach(b=>b.classList.remove('pill--active'));
      btn.classList.add('pill--active');
      applyFilter(btn.dataset.tag);
    });
  });
  loadFeed();
});
</script>
