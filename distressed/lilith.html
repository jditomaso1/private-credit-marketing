<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Lilith Dashboard — Standalone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM + Babel (for JSX in browser) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="h-screen bg-neutral-50">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
      // --- tiny icon helpers (inline SVGs; no imports) ---
      const Icon = ({path, className="w-4 h-4"}) => (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
             strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
             className={className}><path d={path}/></svg>
      );
      const icons = {
        folder: "M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5l2 2h9a2 2 0 0 1 2 2z",
        file: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6",
        link: "M10 13a5 5 0 0 0 7.07 0l1.41-1.41a5 5 0 0 0-7.07-7.07L10 6M14 11a5 5 0 0 0-7.07 0L5.5 12.43a5 5 0 1 0 7.07 7.07L14 18",
        search: "M21 21l-4.35-4.35M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16z",
        download: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3",
        external: "M18 3h3v3M11 13l10-10M21 10V3h-7",
        bot: "M12 8V5a1 1 0 0 1 1-1h3M8 9h8a4 4 0 0 1 4 4v4a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3v-4a4 4 0 0 1 4-4z",
        upload: "M12 5v14M5 12l7-7 7 7",
        paperclip: "M21.44 11.05l-7.78 7.78a5 5 0 1 1-7.07-7.07l8.49-8.49a3.5 3.5 0 0 1 4.95 4.95L11 16",
        x: "M18 6 6 18M6 6l12 12",
        filter: "M22 3H2l8 9.46V21l4-2v-6.54L22 3z",
        chevronDown: "M6 9l6 6 6-6",
        chevronRight: "M9 6l6 6-6 6",
        check: "M20 6 9 17l-5-5",
        spinner: "M12 2a10 10 0 1 0 10 10",
      };

      // --- simple helpers ---
      const cn = (...xs) => xs.filter(Boolean).join(" ");
      const fmt = (iso) => {
        try { return new Date(iso).toLocaleDateString(undefined,{year:"numeric",month:"short",day:"2-digit"});}
        catch { return iso; }
      };

      // --- mock docs (replace with your data fetch) ---
      const MOCK_DOCS = [
        { id:"d-0001", title:"Voluntary Petition (Chapter 11)", docketNo:"1",  date:"2025-10-11", type:"Petition", pages:47, sizeMB:3.2, url:"#", tags:["Case Open"] },
        { id:"d-0002", title:"First-Day Declaration of John Smith, CFO", docketNo:"12", date:"2025-10-12", type:"First-Day Declaration", pages:86, sizeMB:5.8, url:"#", tags:["Day 1"] },
        { id:"d-0003", title:"Schedules of Assets & Liabilities (SOAL)", docketNo:"48", date:"2025-10-18", type:"SOAL", pages:129, sizeMB:10.4, url:"#", tags:["Schedules"] },
        { id:"d-0004", title:"Statement of Financial Affairs (SOFA)", docketNo:"49", date:"2025-10-18", type:"SOFA", pages:77, sizeMB:6.2, url:"#", tags:["Disclosure"] },
        { id:"d-0005", title:"DIP Financing Motion", docketNo:"55", date:"2025-10-19", type:"DIP Motion", pages:64, sizeMB:4.1, url:"#", tags:["DIP"] },
        { id:"d-0006", title:"Interim DIP Order", docketNo:"72", date:"2025-10-21", type:"DIP Order", pages:42, sizeMB:2.7, url:"#", tags:["DIP","Order"] },
      ];

      // --- the dashboard component (no imports) ---
      function LilithDashboard() {
        const [docs, setDocs] = React.useState(MOCK_DOCS);
        const [query, setQuery] = React.useState("");
        const [expanded, setExpanded] = React.useState({});
        const [selected, setSelected] = React.useState([]);
        const [messages, setMessages] = React.useState([{
          id:"m-0001",
          role:"assistant",
          content:"Ready. Select docs on the left to ground responses, then ask about DIP terms, lien stack, milestones, advisors, or key dates.",
        }]);
        const [input, setInput] = React.useState("");
        const [sending, setSending] = React.useState(false);

        const orderedTypes = ["Petition","First-Day Declaration","SOAL","SOFA","DIP Motion","DIP Order","MOR","Other"];

        const groups = React.useMemo(() => {
          const g = {};
          docs
            .filter(d => (d.title+" "+d.type+" "+(d.docketNo||"")).toLowerCase().includes(query.toLowerCase()))
            .forEach(d => { (g[d.type] ||= []).push(d); });
          return g;
        }, [docs, query]);

        const toggleSelect = (id) => {
          setSelected(prev => prev.includes(id) ? prev.filter(x=>x!==id) : [...prev, id]);
        };

        const onSend = async () => {
          const content = input.trim();
          if (!content) return;
          setMessages(m => [...m, {id:`m-${Date.now()}`, role:"user", content} ]);
          setInput("");
          setSending(true);

          // fake answer w/ simple citation
          const cited = selected.length ? docs.find(d=>d.id===selected[0]) : null;
          const answer = (cited && /dip/i.test(content))
            ? `The Interim DIP Order (Dkt. ${cited.docketNo}) authorizes a $150mm superpriority priming facility with 2.50% OID and SOFR+675bps (1.00% floor). Milestones include sale procedures in 21 days and sale hearing by D+45. Adequate protection provides replacement liens and §507(b) claims.`
            : `Here’s what I can summarize from current filings. Ask for CSV export or show source snippets.`;

          const citations = cited ? [{docId:cited.id, page:7, label:`${cited.type} (Dkt. ${cited.docketNo}) p.7`, url:cited.url}] : undefined;

          await new Promise(r=>setTimeout(r,600));
          setMessages(m => [...m, {id:`m-${Date.now()+1}`, role:"assistant", content:answer, citations}]);
          setSending(false);
        };

        const onUpload = (file) => {
          if (!file) return;
          const newDoc = {
            id:`d-${Date.now()}`,
            title:file.name,
            date:new Date().toISOString().slice(0,10),
            type:"Other",
            sizeMB: Math.max(0.1, file.size / (1024*1024)),
            tags:["Uploaded"],
          };
          setDocs(d => [newDoc, ...d]);
        };

        const fileRef = React.useRef();

        return (
          <div className="w-full h-screen bg-neutral-50 flex overflow-hidden">
            {/* Left pane */}
            <aside className="w-[36%] max-w-[640px] min-w-[420px] border-r border-neutral-200 bg-white flex flex-col">
              <div className="px-4 py-3 border-b border-neutral-200 flex items-center gap-2">
                <Icon path={icons.folder} className="w-5 h-5" />
                <h2 className="font-semibold text-neutral-800">Case Files</h2>
                <div className="ml-auto">
                  <button className="inline-flex items-center gap-2 px-3 py-1.5 rounded-xl border border-neutral-200 hover:bg-neutral-50 text-sm"
                          onClick={()=>fileRef.current.click()}>
                    <Icon path={icons.upload} /> Upload
                  </button>
                  <input ref={fileRef} type="file" accept=".pdf,.doc,.docx" className="hidden"
                         onChange={(e)=>onUpload(e.target.files?.[0])}/>
                </div>
              </div>

              <div className="px-3 py-2 border-b border-neutral-200 flex items-center gap-2">
                <div className="flex items-center gap-2 flex-1 bg-neutral-100 rounded-xl px-3 py-2">
                  <Icon path={icons.search} className="w-4 h-4 text-neutral-500" />
                  <input value={query} onChange={(e)=>setQuery(e.target.value)}
                         placeholder="Search docket, title, type…"
                         className="bg-transparent outline-none text-sm w-full" />
                </div>
                <button className="px-2.5 py-2 rounded-xl border border-neutral-200 hover:bg-neutral-50" title="Filters">
                  <Icon path={icons.filter} />
                </button>
              </div>

              <div className="flex-1 overflow-auto">
                {orderedTypes.map(t => {
                  const arr = groups[t] || [];
                  if (!arr.length) return null;
                  const open = expanded[t] ?? true;
                  return (
                    <div key={t}>
                      <button
                        onClick={()=>setExpanded(e => ({...e, [t]: !open}))}
                        className="w-full flex items-center justify-between px-4 py-2 text-left text-neutral-700 hover:bg-neutral-50 border-b"
                      >
                        <div className="flex items-center gap-2 font-medium">
                          <Icon path={open ? icons.chevronDown : icons.chevronRight}/>
                          {t}
                        </div>
                        <span className="text-xs text-neutral-500">{arr.length}</span>
                      </button>
                      {open && (
                        <ul className="divide-y">
                          {arr.map(d => (
                            <li key={d.id} className="px-4 py-3 hover:bg-neutral-50">
                              <div className="flex items-start gap-3">
                                <button
                                  onClick={()=>toggleSelect(d.id)}
                                  className={cn(
                                    "mt-0.5 w-5 h-5 rounded border flex items-center justify-center",
                                    selected.includes(d.id) ? "border-emerald-500 bg-emerald-50" : "border-neutral-300 bg-white"
                                  )}
                                  title={selected.includes(d.id) ? "Unselect" : "Select for chat context"}
                                >
                                  {selected.includes(d.id) && <Icon path={icons.check} className="w-4 h-4 text-emerald-600" />}
                                </button>
                                <div className="flex-1 min-w-0">
                                  <div className="flex items-center gap-2 text-sm font-medium text-neutral-800 truncate">
                                    <Icon path={icons.file} className="text-neutral-500" />
                                    <span className="truncate">{d.title}</span>
                                  </div>
                                  <div className="mt-1 text-xs text-neutral-500 flex items-center gap-3">
                                    {d.docketNo && <span>Dkt. {d.docketNo}</span>}
                                    <span>{fmt(d.date)}</span>
                                    {d.pages ? <span>{d.pages}p</span> : null}
                                    {d.sizeMB ? <span>{d.sizeMB.toFixed(1)} MB</span> : null}
                                  </div>
                                  <div className="mt-2 flex items-center gap-2 flex-wrap">
                                    {(d.tags||[]).map(tag => (
                                      <span key={tag} className="text-[11px] px-2 py-0.5 rounded-full bg-neutral-100 text-neutral-600 border border-neutral-200">
                                        {tag}
                                      </span>
                                    ))}
                                  </div>
                                </div>
                                <div className="flex items-center gap-2">
                                  {d.url && (
                                    <a href={d.url} target="_blank" rel="noreferrer"
                                       className="inline-flex items-center gap-1 text-sm text-neutral-700 hover:text-neutral-900"
                                       title="Open source link">
                                      <Icon path={icons.external} />
                                    </a>
                                  )}
                                </div>
                              </div>
                            </li>
                          ))}
                        </ul>
                      )}
                    </div>
                  );
                })}
              </div>
            </aside>

            {/* Right pane: chat */}
            <section className="flex-1 flex flex-col">
              <div className="px-4 py-3 border-b border-neutral-200 bg-white flex items-center gap-2">
                <Icon path={icons.bot} className="w-5 h-5" />
                <h2 className="font-semibold text-neutral-800">Lilith — Distressed Chat</h2>
                <div className="ml-auto text-xs text-neutral-500">
                  {selected.length ? "Docs selected: " + selected.length : "Tip: select 1–3 docs to ground answers"}
                </div>
              </div>

              <div className="flex-1 overflow-auto p-4 space-y-4">
                {messages.map(m => (
                  <div key={m.id} className={cn("max-w-3xl", m.role==="user" ? "ml-auto" : "")}>
                    <div className={cn("rounded-2xl px-4 py-3 shadow-sm",
                      m.role==="user" ? "bg-neutral-900 text-white" : "bg-white border border-neutral-200")}>
                      <div className="whitespace-pre-wrap text-[15px] leading-relaxed">{m.content}</div>
                      {m.citations?.length ? (
                        <div className="mt-3 flex items-center gap-2 flex-wrap">
                          {m.citations.map((c,i)=>(
                            <a key={i} href={c.url||"#"} target="_blank" rel="noreferrer"
                               className="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200 hover:bg-indigo-100">
                              <Icon path={icons.link} className="w-3.5 h-3.5" />
                              {c.label || "Source"}
                            </a>
                          ))}
                        </div>
                      ) : null}
                    </div>
                  </div>
                ))}
              </div>

              <div className="border-t border-neutral-200 bg-white p-3">
                <div className="max-w-3xl mx-auto">
                  <div className="bg-neutral-100 rounded-2xl px-3 py-2 flex items-end gap-2">
                    <button className="p-2 rounded-xl hover:bg-neutral-200" title="Attach (stub)">
                      <Icon path={icons.paperclip} />
                    </button>
                    <textarea
                      value={input}
                      onChange={(e)=>setInput(e.target.value)}
                      onKeyDown={(e)=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); onSend(); } }}
                      rows="1"
                      placeholder="Ask about lien stack, DIP economics, milestones, advisors…"
                      className="flex-1 bg-transparent outline-none resize-none text-sm max-h-40"
                    />
                    <button
                      onClick={onSend}
                      disabled={sending}
                      className={cn("inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm",
                        sending ? "bg-neutral-300 text-neutral-600" : "bg-neutral-900 text-white hover:bg-black")}
                    >
                      {sending
                        ? (<span className="inline-flex items-center gap-2">
                            <svg className="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                              <path d={icons.spinner}></path>
                            </svg> Thinking…
                           </span>)
                        : (<span className="inline-flex items-center gap-2">
                            <Icon path={icons.bot} /> Ask
                           </span>)
                      }
                    </button>
                  </div>
                  <div className="mt-2 text-[11px] text-neutral-500">
                    Shift+Enter for newline • Selected docs ground the answer and drive citations.
                  </div>
                </div>
              </div>
            </section>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<LilithDashboard />);
    </script>
  </body>
</html>
