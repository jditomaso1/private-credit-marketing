<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shadow Ratings — Media (Beta)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif; margin:0; background:#0b0c0f; color:#e7e9ee; }
    .wrap { max-width: 920px; margin: 28px auto 80px; padding: 0 16px; }
    h1 { font-size: 28px; margin: 0 0 6px; }
    p.sub { color:#a5acba; margin: 0 0 20px; }
    .card { background:#12141a; border:1px solid #1f2430; border-radius:14px; padding:18px; margin: 18px 0; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-3 { grid-column: span 3; } .col-12 { grid-column: span 12; }
    label { display:block; font-size:12px; color:#b6bdca; margin: 6px 0; }
    input, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3140; background:#0f1116; color:#e7e9ee; }
    button { padding:11px 16px; border-radius:12px; border:1px solid #2a3140; background:#1a1f2b; color:#fff; cursor:pointer; }
    button:hover { background:#232a39; }
    .result { font-size:22px; margin-top: 6px; }
    .badge { display:inline-block; padding:4px 10px; border-radius:999px; background:#1f2a19; color:#b9f58a; border:1px solid #2c3a24; font-weight:600; }
    small.hint { color:#7f8899; }
    table { width:100%; border-collapse: collapse; margin-top:12px; }
    th, td { text-align:left; padding:8px 10px; border-bottom:1px solid #252a36; }
    .footer { color:#8891a3; font-size:12px; margin-top:12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Shadow Ratings — Media (Beta)</h1>
    <p class="sub">Quick, editable scorecard aligned to Moody’s Media methodology — drop in headline inputs, get a <span class="mono">scorecard-indicated outcome</span> with drivers.</p>

    <div class="card">
      <div class="grid">
        <div class="col-4">
          <label>Segment</label>
          <select id="segment">
            <option value="broadcasters">Broadcasters</option>
            <option value="cable">Cable Networks</option>
            <option value="outdoor">Outdoor Advertisers & Other</option>
            <option value="publishers">Publishers</option>
          </select>
          <small class="hint">Sets the correct leverage & coverage bands.</small>
        </div>
        <div class="col-4">
          <label>Revenue (USD, billions)</label>
          <input id="revenue" type="number" step="0.01" placeholder="e.g., 3.2" />
        </div>
        <div class="col-4">
          <label>Total Debt (USD, billions)</label>
          <input id="debt" type="number" step="0.01" placeholder="e.g., 5.0" />
        </div>

        <div class="col-4">
          <label>EBITDA (USD, billions)</label>
          <input id="ebitda" type="number" step="0.01" placeholder="e.g., 1.0" />
        </div>
        <div class="col-4">
          <label>Capex (USD, billions)</label>
          <input id="capex" type="number" step="0.01" placeholder="e.g., 0.2" />
        </div>
        <div class="col-4">
          <label>Interest Expense (USD, billions)</label>
          <input id="interest" type="number" step="0.001" placeholder="e.g., 0.3" />
        </div>

        <div class="col-4">
          <label>Market Position (qual)</label>
          <select id="marketPosition">
            <option>Aaa</option><option>Aa</option><option>A</option><option>Baa</option>
            <option>Ba</option><option>B</option><option>Caa</option><option>Ca</option>
          </select>
        </div>
        <div class="col-4">
          <label>Market Share Trajectory (qual)</label>
          <select id="trajectory">
            <option>Aaa</option><option>Aa</option><option>A</option><option>Baa</option>
            <option>Ba</option><option>B</option><option>Caa</option><option>Ca</option>
          </select>
        </div>
        <div class="col-4">
          <label>Business Model (qual)</label>
          <select id="bizModel">
            <option>Aaa</option><option>Aa</option><option>A</option><option>Baa</option>
            <option>Ba</option><option>B</option><option>Caa</option><option>Ca</option>
          </select>
        </div>

        <div class="col-4">
          <label>Financial Policy (qual)</label>
          <select id="finPolicy">
            <option>Aaa</option><option>Aa</option><option>A</option><option>Baa</option>
            <option>Ba</option><option>B</option><option>Caa</option><option>Ca</option>
          </select>
          <small class="hint">Target leverage tolerance, event risk posture, liquidity mgmt.</small>
        </div>

        <div class="col-12">
          <button id="calcBtn">Calculate Rating</button>
        </div>
      </div>
    </div>

    <div class="card" id="results" style="display:none;">
      <div class="grid">
        <div class="col-12">
          <div class="result">Scorecard-Indicated Outcome: <span id="rating" class="badge">—</span></div>
          <div class="footer">Aggregate numeric score: <span id="agg" class="mono">—</span></div>
        </div>
        <div class="col-6">
          <h3>Key Metrics</h3>
          <table>
            <tr><th>Debt / EBITDA</th><td id="mLeverage">—</td></tr>
            <tr><th>(EBITDA − Capex) / Interest</th><td id="mCoverage">—</td></tr>
            <tr><th>Revenue</th><td id="mRevenue">—</td></tr>
          </table>
        </div>
        <div class="col-6">
          <h3>Drivers</h3>
          <ul id="drivers"></ul>
        </div>
      </div>
      <p class="footer">Methodology basis: Moody’s <em>Media</em> scorecard factors, weights, and numeric mapping (Aaa…Ca → 0.5…20.5; weighted aggregate → alphanumeric outcome).  [oai_citation:1‡Rating Methodology_ Media (1).pdf](file-service://file-5TpPyr5EqdTs4pJFzRpHzX)</p>
    </div>
  </div>

  <script>
    // -----------------------------
    // Moody's Media scorecard wiring
    // -----------------------------
    // Numeric mapping for qualitative buckets (Exhibit mapping Aaa..Ca → 1,3,6,9,12,15,18,20; but we’ll use the center of each band for stability)
    const QUAL_TO_NUM = { Aaa:1, Aa:3, A:6, Baa:9, Ba:12, B:15, Caa:18, Ca:20 };

    // Quantitative bands — endpoints for linear interpolation (footnotes define endpoints)
    // Debt/EBITDA: Aaa 0x → Ca 15x; negative EBITDA treated as 20.5 cap
    const DEBT_EBITDA = { minGood: 0.0, maxBad: 15.0 };

    // Coverage (EBITDA - Capex) / Interest: Aaa 40x → Ca -1x
    const COVERAGE = { best: 40.0, worst: -1.0 };

    // Revenue scale (USD billions): Aaa endpoint 60 → Ca endpoint 0.04
    const REVENUE = { best: 60.0, worst: 0.04 };

    // Factor weights (Media): Scale 15%; Business Profile 30% split 10/10/10; Leverage & Coverage 45% split 25%/20%; Financial Policy 10%.
    const W = {
      scale: 0.15,
      marketPosition: 0.10,
      trajectory: 0.10,
      bizModel: 0.10,
      leverage: 0.25,
      coverage: 0.20,
      finPolicy: 0.10
    };

    // Segment-specific: Publishers use a slightly different banding for leverage/coverage inside the rating table,
    // but endpoints for interpolation are the same order of magnitude. For MVP, we keep endpoints but label differences.
    function clamp(x, lo, hi){ return Math.max(lo, Math.min(hi, x)); }

    // Convert a metric value to a numeric score using linear interpolation across Aaa..Ca continuum (0.5..20.5)
    function interpQuant(value, goodEnd, badEnd, higherIsBetter=true){
      if (!isFinite(value)) return 20.5;
      const x = value;
      const a = higherIsBetter ? goodEnd : badEnd;
      const b = higherIsBetter ? badEnd  : goodEnd;
      const t = clamp((x - a) / (b - a), 0, 1);
      return 0.5 + t * (20.5 - 0.5); // maps 0→0.5 (Aaa), 1→20.5 (Ca)
    }

    function ratingFromAggregate(x){
      // Ranges per methodology table (aggregate numeric → outcome)
      const bands = [
        {max:1.5, r:'Aaa'},
        {max:2.5, r:'Aa1'}, {max:3.5, r:'Aa2'}, {max:4.5, r:'Aa3'},
        {max:5.5, r:'A1'},  {max:6.5, r:'A2'},  {max:7.5, r:'A3'},
        {max:8.5, r:'Baa1'},{max:9.5, r:'Baa2'},{max:10.5,r:'Baa3'},
        {max:11.5,r:'Ba1'}, {max:12.5,r:'Ba2'}, {max:13.5,r:'Ba3'},
        {max:14.5,r:'B1'},  {max:15.5,r:'B2'},  {max:16.5,r:'B3'},
        {max:17.5,r:'Caa1'},{max:18.5,r:'Caa2'},{max:19.5,r:'Caa3'},
        {max:20.5,r:'Ca'}
      ];
      for (const b of bands){ if (x <= b.max) return b.r; }
      return 'C';
    }

    function fmt(x){ return isFinite(x) ? x.toFixed(2) : '—'; }

    document.getElementById('calcBtn').addEventListener('click', () => {
      const seg = document.getElementById('segment').value;
      const revenue = parseFloat(document.getElementById('revenue').value);
      const debt = parseFloat(document.getElementById('debt').value);
      const ebitda = parseFloat(document.getElementById('ebitda').value);
      const capex = parseFloat(document.getElementById('capex').value);
      const interest = parseFloat(document.getElementById('interest').value);

      const qMarketPosition = QUAL_TO_NUM[document.getElementById('marketPosition').value];
      const qTrajectory     = QUAL_TO_NUM[document.getElementById('trajectory').value];
      const qBizModel       = QUAL_TO_NUM[document.getElementById('bizModel').value];
      const qFinPolicy      = QUAL_TO_NUM[document.getElementById('finPolicy').value];

      // Derived metrics
      const leverage = (ebitda > 0) ? (debt / ebitda) : Infinity;
      const coverage = (interest > 0) ? ((ebitda - capex) / interest) : ( (ebitda-capex)>0 ? 40 : -1 );

      // Quant → numeric
      const sRevenue  = interpQuant(revenue, REVENUE.best, REVENUE.worst, true);
      const sLev      = interpQuant(leverage, DEBT_EBITDA.minGood, DEBT_EBITDA.maxBad, false); // lower is better
      const sCov      = interpQuant(coverage, COVERAGE.best, COVERAGE.worst, true);            // higher is better

      // Weighted aggregate
      const agg =
        sRevenue * W.scale +
        qMarketPosition * W.marketPosition +
        qTrajectory * W.trajectory +
        qBizModel * W.bizModel +
        sLev * W.leverage +
        sCov * W.coverage +
        qFinPolicy * W.finPolicy;

      const rating = ratingFromAggregate(agg);

      // UI
      document.getElementById('mLeverage').textContent = isFinite(leverage) ? fmt(leverage) + 'x' : 'N/A';
      document.getElementById('mCoverage').textContent = fmt(coverage) + 'x';
      document.getElementById('mRevenue').textContent  = fmt(revenue) + ' B';
      document.getElementById('agg').textContent = fmt(agg);
      document.getElementById('rating').textContent = rating;

      const drivers = [];
      if (leverage >= 6) drivers.push('High leverage weakens leverage & coverage factor.');
      if (coverage <= 2) drivers.push('Low coverage (EBITDA−Capex vs Interest) constrains profile.');
      if (revenue >= 10) drivers.push('Scale supports stronger outcomes.');
      if (document.getElementById('bizModel').value.startsWith('A')) drivers.push('Diversified / recurring revenue mix.');
      if (document.getElementById('trajectory').value.startsWith('B') || document.getElementById('trajectory').value.startsWith('C')) drivers.push('Flat/declining share trajectory.');
      const ul = document.getElementById('drivers'); ul.innerHTML = ''; drivers.forEach(d => { const li = document.createElement('li'); li.textContent = d; ul.appendChild(li); });

      document.getElementById('results').style.display = 'block';
    });
  </script>
</body>
</html>
